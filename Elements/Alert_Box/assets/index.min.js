var SA_ALERT_BOX = function ($scope, $) {
    var SA_Alert_Elem = $scope.find(".sa-el-notbar-outer-container"),
            SA_Alert_Settings = SA_Alert_Elem.data("settings"),
            _this = $(SA_Alert_Elem);

    if (_this.length > 0) {
        if (SA_Alert_Settings["responsive"]) {
            if (SA_Alert_Settings["hideMobs"]) {
                if (
                        $(window).outerWidth() < parseInt(SA_Alert_Settings["mobSize"])
                        ) {
                    SA_Alert_Elem.css("display", "none");
                }
            }

            if (SA_Alert_Settings["hideTabs"]) {
                if (
                        $(window).outerWidth() <
                        parseInt(SA_Alert_Settings["tabSize"]) &&
                        $(window).outerWidth() > parseInt(SA_Alert_Settings["mobSize"])
                        ) {
                    SA_Alert_Elem.css("display", "none");
                }
            }
        }

        if (!elementorFrontend.isEditMode() && !$("body").hasClass("logged-in")) {
            if (SA_Alert_Settings["cookies"]) {
                if (
                        notificationReadCookie(
                                "SA_Alert_-" + SA_Alert_Settings["id"]
                                )
                        ) {
                    SA_Alert_Elem.css("display", "none");
                }
            }
        }

        function notificationSetCookie(cookieName, cookieValue) {
            var today = new Date(),
                    expire = new Date();

            expire.setTime(
                    today.getTime() + 3600000 * SA_Alert_Settings["interval"]
                    );

            document.cookie =
                    cookieName +
                    "=" +
                    encodeURI(cookieValue) +
                    ";expires=" +
                    expire.toGMTString() +
                    "; path=/";
        }

        function notificationReadCookie(cookieName) {
            var theCookie = " " + document.cookie;

            var ind = theCookie.indexOf(" " + cookieName + "=");

            if (ind == -1)
                ind = theCookie.indexOf(";" + cookieName + "=");

            if (ind == -1 || cookieName == "")
                return "";

            var ind1 = theCookie.indexOf(";", ind + 1);

            if (ind1 == -1)
                ind1 = theCookie.length;

            return unescape(theCookie.substring(ind + cookieName.length + 2, ind1));
        }

        if (
                SA_Alert_Settings["location"] == "top" &&
                SA_Alert_Settings["position"] == "sa-el-notbar-relative"
                ) {
            $(SA_Alert_Elem).detach();

            $("body").prepend(_this);
        }

        if (SA_Alert_Settings["layout"] == "boxed") {
            var not_width = SA_Alert_Elem
                    .find(".sa-el-notbar")
                    .parent()
                    .width();

            SA_Alert_Elem.find(".sa-el-notbar").css("width", not_width);

            $(window).on("resize", function () {
                var not_width = SA_Alert_Elem
                        .find(".sa-el-notbar")
                        .parent()
                        .width();

                SA_Alert_Elem.find(".sa-el-notbar").css("width", not_width);
            });
        }

        SA_Alert_Elem.find(".sa-el-notbar-close").on("click", function () {
            if (
                    !elementorFrontend.isEditMode() &&
                    !$("body").hasClass("logged-in")
                    ) {
                if (SA_Alert_Settings["cookies"]) {
                    if (
                            !notificationReadCookie(
                                    "SA_Alert_-" + SA_Alert_Settings["id"]
                                    )
                            ) {
                        notificationSetCookie(
                                "SA_Alert_-" + SA_Alert_Settings["id"],
                                true
                                );
                    }
                }
            }

            if (
                    $(this).hasClass("sa-el-notbar-top") ||
                    $(this).hasClass("sa-el-notbar-edit-top")
                    ) {
                if (SA_Alert_Settings["position"] == "sa-el-notbar-fixed") {
                    $(this)
                            .parentsUntil(".sa-el-notbar-outer-container")
                            .css("top", "-1000px");
                } else {
                    $(SA_Alert_Elem).animate({height: "0"}, 300);
                }
            } else if ($(this).hasClass("sa-el-notbar-bottom")) {
                $(this)
                        .parentsUntil(".sa-el-notbar-outer-container")
                        .css("bottom", "-1000px");
            } else {
                $(this)
                        .parentsUntil(".sa-el-notbar-outer-container")
                        .css({
                            visibility: "hidden",
                            opacity: "0"
                        });
            }
        });
    }
};

jQuery(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
            "frontend/element_ready/sa_el_alert_box.default",
            SA_ALERT_BOX
            );
});