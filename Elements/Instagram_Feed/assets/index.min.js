var SAInstagramFeed = function ($scope, $) {

    var $instagram_gallery = $(".sa-el-insta-grid", $scope).isotope({
        itemSelector: ".sa-el-insta-feed",
        percentPosition: true,
        columnWidth: ".sa-el-insta-box"
    });
    $instagram_gallery.imagesLoaded().progress(function () {
        $instagram_gallery.isotope("layout");
    });

    $(".sa-el-load-more-instagram-feed", $scope).on("click", function () {
        var $this = $(this);
        var $id = $this.attr("data-id");
        var $settings = $this.attr("data-settings");
        var $page = parseInt($this.data("page")) + 1;
        var $class = $this.attr("data-class");
        var $args = '[]';
        var $function = $this.attr("data-function");
        $this.addClass("button--loading");
        $("span", $this).html("Loading...");
        $.ajax({
            url: sa_el_addons_loader.ajaxurl,
            type: "post",
            data: {
                action: "sa_el_addons_loader",
                _wpnonce: sa_el_addons_loader.nonce,
                class: $class,
                function: $function,
                args: $args,
                settings: $settings,
                optional: $page
            },
            success: function (response) {
                response = $.parseJSON(response);
                $this.data("page", $page);

                var $html = $(response.html).filter("div");
                $(".sa-el-insta-grid", $scope).append($html);
                $instagram_gallery.isotope("appended", $html);
                $instagram_gallery.imagesLoaded().progress(function () {
                    $instagram_gallery.isotope("layout");
                });
                console.log(response.pages);
                console.log($page);
                if (response.pages > $page + 1) {
                    $this.removeClass("button--loading");
                    $("span", $this).html("Load more");
                } else {
                    $this.remove();
                }
            },
            error: function () {}
        });
    });
};
jQuery(window).on("elementor/frontend/init", function () {
    elementorFrontend.hooks.addAction(
            "frontend/element_ready/sa_el_instagram_feed.default",
            SAInstagramFeed
            );
});